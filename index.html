<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Guide - Verification</title>
    <link rel="stylesheet" href="style.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- YOUR PROVIDED AMPLITUDE SNIPPET -->
    <script src="https://cdn.amplitude.com/libs/analytics-browser-2.11.1-min.js.gz"></script>
    <script src="https://cdn.amplitude.com/libs/plugin-session-replay-browser-1.8.0-min.js.gz"></script>
    <script>
      window.amplitude.add(window.sessionReplay.plugin({sampleRate: 1}));
      // Using your provided API key and init options
      window.amplitude.init('3df66b6aa0ae7f04c1cf1593bd081e5b', undefined, {"autocapture":{"elementInteractions":true}});
    </script>
    <!-- END AMPLITUDE SNIPPET -->

    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 20px; box-sizing: border-box; }
        .gate-container { padding: 30px 40px; max-width: 500px; width: 100%; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="gate-container" id="initialGateContent">
        <h1>Setup Guide Access</h1>
        <p>To access the setup instructions, a quick verification is required.</p>
        <button id="proceedToVerificationBtn" class="button-primary">Proceed to Verification</button>
    </div>

    <div id="siteGateTwoFactorAuthModal" class="modal"> 
        <div class="modal-content">
            <span class="close-button" id="closeSiteGateTwoFactorAuthModalBtn">Ã—</span>
            <h2>Verification Required</h2>
            <p id="siteGateTwoFactorAuthInstruction">A 6-digit code is needed to proceed. Please enter the code you received.</p>
            <form id="siteGateTwoFactorAuthForm">
                <div class="form-group"> 
                    <label for="siteGateTwoFactorAuthCode">Verification Code:</label>
                    <input type="text" id="siteGateTwoFactorAuthCode" name="siteGateTwoFactorAuthCode" required maxlength="6" pattern="\d{6}" inputmode="numeric" autocomplete="one-time-code">
                </div>
                <button type="submit" class="button-primary"> 
                    Verify & View Instructions
                </button>
                <p id="siteGateTwoFactorAuthMessage" class="form-message"></p>
            </form>
        </div>
    </div>

    <script>
        let siteGateGeneratedCode = '';

        function showSiteGateModal() {
            const modal = document.getElementById('siteGateTwoFactorAuthModal');
            if (modal) {
                modal.style.display = 'flex'; 
                requestAnimationFrame(() => { modal.classList.add('modal-visible'); });
            }
        }

        function hideSiteGateModal() {
            const modal = document.getElementById('siteGateTwoFactorAuthModal');
            if (modal) {
                modal.classList.remove('modal-visible');
                setTimeout(() => { if (!modal.classList.contains('modal-visible')) { modal.style.display = 'none'; } }, 300);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const proceedBtn = document.getElementById('proceedToVerificationBtn');
            const siteGateModal = document.getElementById('siteGateTwoFactorAuthModal');
            const siteGateForm = document.getElementById('siteGateTwoFactorAuthForm');
            const siteGateCodeField = document.getElementById('siteGateTwoFactorAuthCode');
            const siteGateMessage = document.getElementById('siteGateTwoFactorAuthMessage');
            const siteGateInstruction = document.getElementById('siteGateTwoFactorAuthInstruction');
            const closeSiteGateBtn = document.getElementById('closeSiteGateTwoFactorAuthModalBtn');
            const initialGateContent = document.getElementById('initialGateContent');

            // Autocapture should handle page views if enabled in init.
            // If specific event needed:
            // if (window.amplitude) {
            //     window.amplitude.logEvent('Page View', { page_name: 'Instructions Verification Gate' });
            // }

            if (proceedBtn) {
                proceedBtn.addEventListener('click', () => {
                    siteGateGeneratedCode = Math.floor(100000 + Math.random() * 900000).toString();
                    console.log("INSTRUCTIONS ACCESS Verification Code (New index.html - Gate): " + siteGateGeneratedCode);

                    alert("A 6-digit verification code is required to view the instructions.\n\nFor demonstration purposes, your code is: " + siteGateGeneratedCode + "\n\nPlease enter this code in the verification screen.");
                    
                    if (siteGateInstruction) {
                         siteGateInstruction.textContent = "A 6-digit verification code is required. Please enter the provided code to access the instructions.";
                    }
                    if (siteGateForm) siteGateForm.reset();
                    if (siteGateMessage) {
                        siteGateMessage.textContent = '';
                        siteGateMessage.className = 'form-message';
                    }
                    
                    if(initialGateContent) initialGateContent.style.display = 'none'; 
                    showSiteGateModal();
                    if (siteGateCodeField) siteGateCodeField.focus();

                    if (window.amplitude) {
                        window.amplitude.logEvent('Gate Verification Initiated');
                    }
                });
            }

            if (siteGateForm) {
                siteGateForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const enteredCode = siteGateCodeField.value;
                    if (enteredCode === siteGateGeneratedCode) {
                        siteGateMessage.textContent = "Verification successful! Loading instructions...";
                        siteGateMessage.className = 'form-message success';
                        sessionStorage.setItem('instructionsAccessGranted', 'true'); 
                        
                        if (window.amplitude) {
                            window.amplitude.logEvent('Gate Verification Succeeded');
                        }

                        setTimeout(() => {
                            window.location.href = 'home.html'; // *** CORRECTED REDIRECT ***
                        }, 1000);
                    } else {
                        siteGateMessage.textContent = "Invalid verification code. Please try again.";
                        siteGateMessage.className = 'form-message error';
                        
                        if (window.amplitude) {
                            window.amplitude.logEvent('Gate Verification Failed', { reason: 'Invalid Code' });
                        }
                        siteGateCodeField.value = '';
                        siteGateCodeField.focus();
                    }
                });
            }

            if (closeSiteGateBtn) {
                closeSiteGateBtn.addEventListener('click', () => {
                    hideSiteGateModal();
                    if(initialGateContent) initialGateContent.style.display = 'block';
                    if (siteGateMessage) {
                        siteGateMessage.textContent = '';
                        siteGateMessage.className = 'form-message';
                    }
                     if (window.amplitude) {
                        window.amplitude.logEvent('Gate Verification Modal Closed');
                    }
                });
            }
            
            window.addEventListener('click', (event) => {
                if (event.target === siteGateModal) {
                    hideSiteGateModal();
                    if(initialGateContent) initialGateContent.style.display = 'block';
                     if (siteGateMessage) {
                        siteGateMessage.textContent = '';
                        siteGateMessage.className = 'form-message';
                    }
                    if (window.amplitude) {
                        window.amplitude.logEvent('Gate Verification Modal Closed (Background Click)');
                    }
                }
            });
        });
    </script>
</body>
</html>